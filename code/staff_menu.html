<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>職員メニュー</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <a href="login.html" class="title">流山市ファミリーサポートセンター(職員用画面)</a>
</header>

<main class="staff-menu">

  <div class="staff-menu-inner">

    <!-- 左側：カレンダーボックス -->
    <div class="staff-menu-left">
      <div class="calendar-box">
        <div class="calendar-header">
          <span id="calendarTitle"></span>
        </div>
        <table class="calendar-table">
          <thead>
          <tr>
            <th>日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th>
          </tr>
          </thead>
          <tbody id="calendarBody">
          <!-- JSで日付が入る -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- 右側：ボタン4つ -->
    <div class="staff-menu-right">
      <a href="staff_user_members.php"       class="staff-menu-btn">利用会員データ</a>
      <a href="staff_provider__members.php"   class="staff-menu-btn">提供会員データ</a>
      <a href="ai_match_ui.html"        class="staff-menu-btn">マッチング候補決定</a>
      <a href="temporary_matches_ui.html" class="staff-menu-btn">マッチング決定</a>
      <a href="confirmed_matches_ui.html" class="staff-menu-btn">確定済みマッチ一覧</a>
      <a href="staff_activity_reports.php" class="staff-menu-btn">活動報告書</a>
    </div>

  </div>

</main>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const titleEl = document.getElementById('calendarTitle');
    const bodyEl  = document.getElementById('calendarBody');

    const today = new Date();
    const year  = today.getFullYear();
    const month = today.getMonth(); // 0: Jan

    // タイトル（例：2025年11月）
    titleEl.textContent = `${year}年${month + 1}月`;

    // 月の最初と最後
    const firstDay = new Date(year, month, 1);
    const lastDay  = new Date(year, month + 1, 0);

    bodyEl.innerHTML = "";
    let row = document.createElement('tr');

    // 1日まで空セル
    for (let i = 0; i < firstDay.getDay(); i++) {
      row.appendChild(document.createElement('td'));
    }

    // 日付セル
    for (let d = 1; d <= lastDay.getDate(); d++) {
      const cell = document.createElement('td');
      cell.textContent = d;

      // この日付を "YYYY-MM-DD" 形式で持たせる
      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
      cell.dataset.date = dateStr;
      cell.classList.add('calendar-cell');   // CSS用クラス

      // 今日なら強調
      if (
        d === today.getDate() &&
        year === today.getFullYear() &&
        month === today.getMonth()
      ) {
        cell.classList.add('today');
      }

      // ==== ここから hover 時の処理 ====
      cell.addEventListener('mouseenter', () => {
        const existing = cell.querySelector('.calendar-tooltip');
        if (existing) existing.remove();   // 二重生成防止

        const tip = document.createElement('div');
        tip.className = 'calendar-tooltip';
        tip.textContent = '読み込み中…';
        cell.appendChild(tip);

        const date = cell.dataset.date;

        // PHP に予定を聞きに行く
        fetch(`get_schedule.php?date=${encodeURIComponent(date)}`)
          .then(res => res.json())
          .then(data => {
            if (data.events && data.events.length > 0) {
              tip.textContent = data.events
                .map(ev => `${ev.start_time} ${ev.title}`)
                .join('\n');
            } else {
              tip.textContent = '予定なし';
            }
          })
          .catch(() => {
            tip.textContent = '取得エラー';
          });
      });

      cell.addEventListener('mouseleave', () => {
        const tip = cell.querySelector('.calendar-tooltip');
        if (tip) tip.remove();
      });
      // ==== ここまで hover の処理 ====

      row.appendChild(cell);

      // 土曜日で改行
      if ((firstDay.getDay() + d) % 7 === 0) {
        bodyEl.appendChild(row);
        row = document.createElement('tr');
      }
    }

    // 端数の行
    if (row.children.length > 0) {
      while (row.children.length < 7) {
        row.appendChild(document.createElement('td'));
      }
      bodyEl.appendChild(row);
    }
  });
</script>

</body>
</html>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const savedColor = localStorage.getItem('headerColor');
  if (savedColor) {
      document.querySelector('header').style.background = savedColor;
  }
});
</script>
